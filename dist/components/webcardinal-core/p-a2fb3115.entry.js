import{r as t,c as i,h as s,H as e}from"./p-bb51835b.js";import{i as a}from"./p-9b22281c.js";import{H as n,G as o,S as h,W as r,R as c,U as d}from"./p-f5c9fd96.js";import{H as w}from"./p-5e0464e4.js";import"./p-e506992e.js";import{r as l,C as f}from"./p-f7ebc241.js";import"./p-3934984c.js";import"./p-f8a2682a.js";async function u(t){try{return!0===(await fetch(t,{method:"get"})).ok}catch(i){return console.log(`Error while checking a page from ${t}`,i),!1}}const{join:p}=d,m=class{constructor(s){t(this,s),this.getRoutingStateEvent=i(this,"webcardinal:routing:get",7),this.content="",this.watchSkin=!1,this.hooks={},this.basePath="/",this.loader="default",this.skin="default",this.saveState=!1,this.isFallbackPage=!1}async componentWillLoad(){if(!this.host.isConnected)return;await this.activateHooks(),window.WebCardinal.history=this.history;const t=this.history.location.pathname;await this.callHook(o.BEFORE_PAGE),window.WebCardinal.state.skin!==this.skin&&(this.skin=window.WebCardinal.state.skin),t===this.history.location.pathname?(await this.setSkinContext(),this.watchSkin=!0,this.routingState=await l(this),await this.setTranslationsContext(),await this.setPageContent(),this.setWebCardinalState()):this.loader="none"}async componentDidLoad(){!function(){if(!window.frameElement)return;const t=window.frameElement.getAttribute("identity"),i=window.frameElement.classList.contains(n);t&&!i&&(window.frameElement.classList.add(n),window.parent.document.dispatchEvent(new CustomEvent(t,{detail:{status:"completed"}})))}(),await this.callHook(o.AFTER_PAGE)}async disconnectedCallback(){await this.callHook(o.CLOSED_PAGE)}async skinHandle(){this.watchSkin&&(this.content="",await this.setSkinContext(),await this.setTranslationsContext(),await this.setPageContent(),this.setWebCardinalState())}async activateHooks(){var t;if(!window.WebCardinal.hooks)return;this.hooks={};const{hooks:i}=window.WebCardinal;for(const s of[o.BEFORE_PAGE,o.AFTER_PAGE,o.CLOSED_PAGE])(null===(t=i[s])||void 0===t?void 0:t[this.tag])&&(this.hooks[s]=i[s][this.tag])}async setSkinContext(){if(this.src.startsWith("http"))return void(this.activeSrc=this.src);if("none"!==this.skin){if("default"!==this.skin){const t=p(this.basePath,h,this.skin,this.src).pathname;if(await u(t))return void(this.activeSrc=t)}return void(this.activeSrc=p(this.basePath,this.src).pathname)}const t=r();if("default"!==t){const i=p(this.basePath,h,t,this.src).pathname;if(await u(i))return void(this.activeSrc=i)}this.activeSrc=p(this.basePath,this.src).pathname}async setPageContent(){const t=this.activeSrc,i=await async function(t){try{const i=await fetch(t),s=await i.text();if(!i.ok)throw new Error(s);return s}catch(i){return console.log(`Error while loading a page from ${t}`,i),null}}(t);this.content=i||`\n        <section style="padding: 1rem">\n            <h4>Page from <code>${t}</code> could not be loaded!</h4>\n            <h5>Current skin is <code>${this.skin}</code></h5>\n        </section>\n      `}async setTranslationsContext(){if(c()){if(this.isFallbackPage)return void await f.loadAndSetTranslationsForPage(this.routingState,this.src);await f.loadAndSetTranslationsForPage(this.routingState)}}setWebCardinalState(){this.saveState&&(window.WebCardinal.state.skin=this.skin,window.WebCardinal.state.page={loader:this.host,src:this.activeSrc},this.tag&&(window.WebCardinal.state.page.tag=this.tag))}async callHook(t){"function"==typeof this.hooks[t]&&await this.hooks[t]()}render(){switch(this.loader){case"parser":{const t=new DOMParser;return this.host.append(t.parseFromString(this.content,"text/html")),s(e,Object.assign({},{style:{width:"100%",height:"100%"}}),s("slot",null))}case"iframe":return s("iframe",Object.assign({},{frameBorder:0,srcDoc:this.content,sandbox:"allow-scripts",style:{display:"block",overflow:"hidden",width:"100%",height:"100%"}}));case"object":return s("object",Object.assign({},{data:this.activeSrc,type:"text/html",style:{display:"block",width:"100%",height:"100%"}}));case"none":return"";default:{const t={style:{width:"100%",height:"100%"}};return this.host.innerHTML=this.content,s(e,Object.assign({},t),s("slot",null))}}}static get watchers(){return{skin:["skinHandle"]}}};(function(t,i,s,e){var a,n=arguments.length,o=n<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,s,e);else for(var h=t.length-1;h>=0;h--)(a=t[h])&&(o=(n<3?a(o):n>3?a(i,s,o):a(i,s))||o);n>3&&o&&Object.defineProperty(i,s,o)})([w()],m.prototype,"host",void 0),a(m);export{m as webc_app_loader}