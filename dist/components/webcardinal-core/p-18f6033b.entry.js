import{r as t,c as s,h as i}from"./p-bb51835b.js";import{i as e}from"./p-9b22281c.js";import{C as n}from"./p-ef344be1.js";import{d as o,c as r,V as a,R as l}from"./p-f5c9fd96.js";import{H as h}from"./p-5e0464e4.js";import{v as c,w as d,C as m}from"./p-0c675925.js";import{C as u}from"./p-c8e4972a.js";import{p}from"./p-f8a2682a.js";import"./p-e506992e.js";import{B as f}from"./p-3842b566.js";import"./p-3934984c.js";import"./p-8d1ed174.js";const b=class{constructor(i){t(this,i),this.getModelEvent=s(this,"webcardinal:model:get",7),this.getTranslationModelEvent=s(this,"webcardinal:translationModel:get",7),this.getChainPrefix=s(this,"webcardinal:parentChain:get",7),this.controller="",this.disableContainer=!1}async componentWillLoad(){if(!this.host.isConnected)return;if(this.host.hasAttribute("instantiate"))return;this.host.setAttribute("instantiate","");const[t,s]=this.resolveControllerElement();let i,e;this.controllerElement=t;const n=this.history;if(this.chain=c(this.host),-1!==this.chain.indexOf(o)){const s=await p(this.getChainPrefix);this.chain=d(s,this.chain);try{i=await p(this.getModelEvent),e=await p(this.getTranslationModelEvent);const s=this.chain?this.chain.slice(1):null;i=i.getChainValue(s),this.chain&&(this.chain="@"),this.controllerInstance=await this.loadController(t,n,i,e)}catch(t){console.error(t)}}else this.controllerInstance=await this.loadController(t,n),i=this.controllerInstance.model,e=this.controllerInstance.translationModel;this.host.hasAttribute(r)&&!this.host.hasAttribute(a)||(f.bindChildNodes(s,{model:i,translationModel:e,recursive:!0,enableTranslations:l()}),this.listeners=new m(s,{model:i,translationModel:e,chain:this.chain}),this.listeners.getModel.add(),this.listeners.getTranslationModel.add(),this.listeners.getParentChain.add())}async connectedCallback(){if(this.listeners){const{getModel:t,getTranslationModel:s,getParentChain:i}=this.listeners;null==t||t.add(),null==s||s.add(),null==i||i.add()}}async disconnectedCallback(){if(this.listeners){const{getModel:t,getTranslationModel:s,getParentChain:i}=this.listeners;null==t||t.remove(),null==s||s.remove(),null==i||i.remove()}setTimeout((()=>{var t,s,i;document.body.contains(this.controllerElement)||(null===(t=this.controllerInstance)||void 0===t||t.disconnectedCallback(),this.chain||null===(i=null===(s=this.controllerInstance)||void 0===s?void 0:s.model)||void 0===i||i.cleanReferencedChangeCallbacks())}),100)}async componentDidLoad(){this.disableContainer&&(Array.from(this.host.childNodes).forEach((t=>this.host.parentNode.insertBefore(t,this.host))),this.host.remove())}async getModel(){if(this.controllerInstance)return this.controllerInstance.model}async getTranslationModel(){if(this.controllerInstance)return this.controllerInstance.translationModel}resolveControllerElement(){const t=this.host;return this.disableContainer?[t.parentElement,t]:[t,t]}async loadController(t,s,i,e){const o=()=>(this.host.setAttribute(r,""),new n(t,s,i,e));if(this.host.hasAttribute("controller-name")&&!this.controller&&(console.warn(['Attribute "controller-name" is deprecated!','Use "controller" instead!'].join("\n"),"target:",this.host),this.controller=this.host.getAttribute("controller-name")),"string"!=typeof this.controller)return console.error('"controller" must be a string!'),o();if(0===this.controller.length)return o();try{const n=await u.getController(this.controller);try{return new n(t,s,i,e)}catch(t){return console.error(`Controller "${this.controller}" has runtime errors!`,"Controller is not a constructor"!==t.message?t:""),o()}}catch(t){return console.error(`Error while loading controller "${this.controller}"`,t),o()}}render(){return this.disableContainer?null:i("slot",null)}};(function(t,s,i,e){var n,o=arguments.length,r=o<3?s:null===e?e=Object.getOwnPropertyDescriptor(s,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,s,i,e);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(o<3?n(r):o>3?n(s,i,r):n(s,i))||r);o>3&&r&&Object.defineProperty(s,i,r)})([h()],b.prototype,"host",void 0),e(b);export{b as webc_container}