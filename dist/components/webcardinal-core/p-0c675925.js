import{g as t}from"./p-8d1ed174.js";import{V as e,b as n,d as i,f as a,h as r,g as o,s,F as c,e as u,U as l}from"./p-f5c9fd96.js";import"./p-e506992e.js";const d="webcardinal:config:getCoreType",f="webcardinal:config:getDocsSource",h="webcardinal:config:getIdentity",g="webcardinal:config:getLogLevel",v="webcardinal:config:getRouting",p="webcardinal:model:get",b="webcardinal:routing:get",m="webcardinal:tags:get",y="webcardinal:translationModel:get",w="webcardinal:parentChain:get",$=new Map;function k(t){let a=t.hasAttribute(e)?t.getAttribute(e):null;if(!a&&t.hasAttribute(n)&&(console.warn(`Attribute ${n} is deprecated for binding! Use the ${e} key attribute instead.`,t),a=t.getAttribute(n)),!a)return"";if(!a.startsWith(i)){const e=t.tagName.toLowerCase();return console.error([`Invalid chain found for ${e} (chain: "${a}")!`,`A valid chain must start with "${i}".`].join("\n")),""}return a}function M(t,e){return t=t.split("@").join(""),e=e.split("@").join(""),t&&e?`@${t}.${e}`:e?`@${e}`:t?`@${t}`:"@"}function T(t,e,n){$.set(t,{chain:e,changeHandler:n})}function x(t,e,n){$.set(t,{expression:e,changeHandler:n})}function A(t,e){const n=t=>{if(t.childNodes.length>0)for(const i of t.childNodes){if($.has(i)){const t=$.get(i);t.chain?e.offChange(t.chain,t.changeHandler):e.offChangeExpressionChain(t.expression,t.changeHandler),$.delete(i)}n(i)}};n(t)}function N(t,e,n){let i=null;for(;t;){if(t.matches(e)){i=t;break}if(n&&t.matches(n))break;t=t.parentElement}return i}function j(t,{key:e,value:n}){if(!a.includes(e))if(["innerHTML","innerText"].includes(e)&&console.warn(`Model property "${e}" can be short handed, try "${e.substr(5).toLowerCase()}" instead!\n`,"target element:",t),["data-tag","data-view-model"].includes(e)&&console.warn(`Model property "${e}" can be shorthanded, try "${e.substr(5)}" instead!\n`,"target model:",t.getAttribute("data-model")),function(t){return["value","innerText","innerHTML"].includes(t)}(e=function(t){switch(t){case"model":return"data-view-model";case"tag":return"data-tag";case"text":return"innerText";case"html":return"innerHTML";default:return t}}(e))){if("INPUT"===t.tagName&&"file"===t.getAttribute("type")&&"value"===e)return;t[e]=n}else if("class"!==e)"boolean"!=typeof n?"string"!=typeof n?"object"!=typeof n||(t[e]=n):t.setAttribute(e,n):n?t.setAttribute(e,""):t.removeAttribute(e);else{if(""===n)return void(t.className="");if("string"==typeof n)return void t.classList.add(n);if("object"==typeof n){for(const[e,i]of Object.entries(n))i?t.classList.add(e):t.classList.remove(e);return}}}function C(t,e){return"input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")&&"checked"===e||"value"===e}function I(t,a,s=i,c=null){t.tagName.startsWith(r.toUpperCase())||Array.from(t.attributes).forEach((r=>{const u=r.nodeName;let l=r.nodeValue;if(u===e||u===n)return;if(!l.startsWith(s))return;if(l=l.slice(1),c&&(l=B(c,l)),t.webcModelChains||(t.webcModelChains={}),t.webcModelChains[u]=l,j(t,{key:u,value:a.getChainValue(l)}),o.includes(t.tagName.toLowerCase()))return;s===i&&C(t,u)&&L(t,a,l);const d=()=>{j(t,{key:u,value:a.getChainValue(l)})};if(a.onChange(l,d),T(t,l,d),a.hasExpression(l)){j(t,{key:u,value:a.evaluateExpression(l)}),s===i&&C(t,u)&&L(t,a,l);const e=()=>{j(t,{key:u,value:a.evaluateExpression(l)})};a.onChangeExpressionChain(l,e),x(t,l,e)}}))}function H(t){t.nodeType===Node.ELEMENT_NODE&&(t.removeAttribute("slot"),t.removeAttribute("hidden"))}function L(t,e,n){const i=t.tagName.toLowerCase();["input","textarea"].includes(i)?t.addEventListener("input",(a=>{const r=a.target;"input"!==i||"checkbox"!==t.getAttribute("type")?"input"!==i||"file"!==t.getAttribute("type")?e.setChainValue(n,r.value):e.setChainValue(n,Array.from(r.files)):e.setChainValue(n,r.checked)})):"select"===i&&t.addEventListener("change",(t=>{e.setChainValue(n,t.target.value)}))}function P(t,e,n){if(!e.getChainValue(n))return;const i="input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")?"checked":"value";L(t,e,`${n}.${i}`)}function R(t,e){return Array.from(t.attributes).some((t=>t.nodeName===e))}function U(t,e){return t.filter((t=>t.getAttribute("slot")===e))}function S(t,e){return U(t,e).map((t=>t.outerHTML)).join("")}function q(t,e){for(A(t,e);t.children.length>0;)t.children[0].remove()}function z(t,e){for(A(t,e);t.childNodes.length>0;)t.childNodes[0].remove()}function B(...t){return t.filter((t=>null!=t)).filter(String).join(".")}function D(t){let e;if("function"==typeof t.detail?e=t.detail:t.detail&&"function"==typeof t.detail.callback&&(e=t.detail.callback),e)return e;console.warn("Invalid callback for event",t)}function E(t,e){t.hasAttribute(s)||t.setAttribute(s,`${t.children.length}`),t.addEventListener("webcardinal:parentChain:get",(n=>{n.stopImmediatePropagation();const i=D(n);if(!i)return;if(n.target&&"string"!=typeof n.target.tagName)return i(void 0,e);let a=n.target;"webc-component"===n.target.tagName.toLowerCase()&&(a=a.parentElement);let r=a;for(;r.parentElement&&!r.parentElement.hasAttribute(c);)r=r.parentElement;if(!r)return i(void 0,e);let o=Array.from(t.children).indexOf(r);if(o<0)return i(void 0,e);let u=Number.parseInt(t.getAttribute(s));return(Number.isNaN(u)||u<=0)&&(u=1),o=Math.floor(o/u),i(void 0,B(e,o))}))}class F{constructor(e,{model:n,translationModel:a,tags:r,routing:o,chain:s}){this.listeners={getModel:()=>null,getTranslationModel:()=>null,getTags:()=>null,getRouting:()=>null,getParentChain:()=>null},this.host=e,n&&(this.listeners.getModel=t=>{t.stopImmediatePropagation();const e=D(t);if(e){if(t.detail.chain){let a=t.detail.chain;return a.startsWith(i)?(a=a.slice(1),void e(void 0,n.getChainValue(a))):(console.warn([`Invalid chain found for ${t} (chain: "${a}")!`,`A valid chain must start with "${i}".`].join("\n")),void e(void 0,n))}e(void 0,n)}}),a&&(this.listeners.getTranslationModel=t=>{t.stopImmediatePropagation();const e=D(t);if(e){if(t.detail.chain){let n=t.detail.chain;return n.startsWith(u)?(n=n.slice(1),void e(void 0,a.getChainValue(n))):(console.warn([`Invalid chain found for ${t} (chain: "${n}")!`,`A valid chain must start with "${u}".`].join("\n")),void e(void 0,a))}e(void 0,a)}}),r&&(this.tags=r,this.listeners.getTags=e=>{e.stopImmediatePropagation();const n=D(e);if(n){if(e.detail.tag){if(!this.tags[e.detail.tag])return n(`There is no page tag "${e.detail.tag}" registered in webcardinal.json`);const i=t(),{pathname:a}=l.join(i.routing.baseURL,this.tags[e.detail.tag]);return n(void 0,a)}return n(void 0,this.tags)}}),o&&(this.routing=o,this.listeners.getRouting=t=>{t.stopImmediatePropagation();const e=D(t);e&&e(void 0,this.routing)}),void 0!==s&&(this.chain=s,this.listeners.getParentChain=t=>{t.stopImmediatePropagation();const e=D(t);e&&e(void 0,this.chain)})}get getModel(){const t="webcardinal:model:get";return{add:()=>this.host.addEventListener(t,this.listeners.getModel),remove:()=>this.host.removeEventListener(t,this.listeners.getModel),eventName:t}}get getTranslationModel(){const t="webcardinal:translationModel:get";return{add:()=>this.host.addEventListener(t,this.listeners.getTranslationModel),remove:()=>this.host.removeEventListener(t,this.listeners.getTranslationModel),eventName:t}}get getParentChain(){const t="webcardinal:parentChain:get";return{add:()=>this.host.addEventListener(t,this.listeners.getParentChain),remove:()=>this.host.removeEventListener(t,this.listeners.getParentChain),eventName:t}}get getTags(){if(!this.tags)return;const t="webcardinal:tags:get";return{add:()=>this.host.addEventListener(t,this.listeners.getTags),remove:()=>this.host.removeEventListener(t,this.listeners.getTags),eventName:t}}get getRouting(){if(!this.routing)return;const t="webcardinal:routing:get";return{add:()=>this.host.addEventListener(t,this.listeners.getRouting),remove:()=>this.host.removeEventListener(t,this.listeners.getRouting),eventName:t}}}export{D as A,E as B,F as C,d as E,f as a,h as b,g as c,v as d,p as e,b as f,m as g,y as h,w as i,N as j,I as k,L as l,P as m,R as n,U as o,S as p,q,H as r,j as s,z as t,B as u,k as v,M as w,T as x,x as y,A as z}