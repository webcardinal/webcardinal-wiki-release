import{s as e,u as n,B as t,z as a,k as s,x as o,y as i,t as r,r as l,o as c,n as f,m as d}from"./p-04a6fcf5.js";import{F as u,d as b,m,n as h,o as p,p as v,l as x,e as y,k as w,q as $,r as M,I as g,x as j,y as A,t as k,u as E,w as P,v as C,z as O,g as N,W as T,i as W,b as V,j as z,V as B,D as I,h as S}from"./p-f5c9fd96.js";import{c as q,d as D}from"./p-e506992e.js";function F(n,t,a){const s=t.getChainValue(a);if(s){for(const[t,a]of Object.entries(s))e(n,{key:t,value:a});if(!0===s._saveElement){for(const e in n)"function"==typeof n[e]&&(n[e]=n[e].bind(n));s.getElement||t.setChainValue(a,Object.assign(Object.assign({},s),{getElement:()=>n}))}}if(t.hasExpression(a)){const s=t.evaluateExpression(a);for(const[t,a]of Object.entries(s))e(n,{key:t,value:a})}}function U(e){return e.nodeType===Node.ELEMENT_NODE}function G(e){return e.nodeType===Node.TEXT_NODE&&e.nodeValue&&e.nodeValue.trim()}function H(e,n){return U(e)&&e.getAttribute("slot")===n}function J(e,t,a,s=null){if(N.includes(e.nodeName.toLowerCase()))return;if(e.nodeType!==Node.TEXT_NODE||!e.nodeValue||!e.nodeValue.trim())return;const r=[...e.nodeValue.matchAll(/\{\{\s*([^\s}}]+)\s*\}\}/g)];if(!r.length)return;const l=r.map((e=>({expression:e[0],chainWithPrefix:e[1]}))).filter((({chainWithPrefix:e})=>e.startsWith(b)||e.startsWith(y))).map((e=>{let{chainWithPrefix:o}=e;const i=o.startsWith(y);let r=e.chainWithPrefix.slice(1);!i&&s&&(r=n(s,r),o=`${b}${r}`);const l=i?a:t;return Object.assign(Object.assign({},e),{chain:r,isTranslation:i,isModel:!i,isModelExpression:l.hasExpression(r),evaluateModelExpression:()=>l.evaluateExpression(r),model:l,getChainValue:()=>{let e=l.getChainValue(r);if(i&&void 0===e){const{pathname:n}=window.location,t=T();console.warn(`No translations found for skin "${t}", page "${n}" and chain "${r}"`),e=r}return e}})}));if(!l.length)return;const c=e.nodeValue,f=()=>{let n=c;l.forEach((({expression:e,getChainValue:t,isModelExpression:a,evaluateModelExpression:s})=>{let o=t();["number","boolean"].includes(typeof o)&&(o=o.toString()),!o&&a&&(o=a?s():""),n=n.replace(e,o||"")})),e.nodeValue=n};f(),l.filter((e=>e.isModel)).forEach((({model:n,chain:t,isModelExpression:a})=>{const s=()=>{f()};if(n.onChange(t,s),o(e,t,s),a){const a=()=>{f()};n.onChangeExpressionChain(t,a),i(e,t,a)}}))}const K={bindElement:(e,T={model:null,translationModel:null})=>{const{model:L,translationModel:Q,chainPrefix:R,enableTranslations:X=!1,recursive:Y=!1}=T;if(L){if(G(e))J(e,L,Q,R);else if(U(e)){const U=e;if(window.WebCardinal.components.tags.has(U.tagName.toLowerCase()))return;if(N.includes(U.tagName.toLowerCase()))return s(U,L,b,R);if(U.hasAttribute(W)){let e;U.hasAttribute(V)&&(e=U.getAttribute(V),(null==e?void 0:e.startsWith(b))&&(e=e.slice(1)));const t=n(R,e);U[z]=()=>L.hasExpression(t)?L.evaluateExpression(t):L.toObject(t)}const Z=f(U,g),_=f(U,u);if(Z&&_)console.error("Cannot use both data-if and data-for attributes on the same element",U);else if(Z)!function(e,t,{model:a,translationModel:f,chainPrefix:d,enableTranslations:u=!1}={model:null,translationModel:null}){let m=e.getAttribute(g);if(!m.startsWith(b))return void console.warn(`Attribute "${g}" doesn't start with the chain prefix!`);m=m.slice(1);const h=n(d,m),p=function(e){return(e.getAttribute(j)||"").split(" ").filter(String)}(e).includes(A),v=Array.from(e.children);let x;!function(e){e.TRUE="webcardinal:data-if:true",e.FALSE="webcardinal:data-if:false",e.LOADING="webcardinal:data-if:loading",e.NO_DATA="webcardinal:data-if:no-data"}(x||(x={}));let w,$="webcardinal:data-if:first-render";w=c(v,k);const M=c(v,E),N=c(v,P),T=c(v,C);[w,M,N,T].find((e=>e.length>0))||(w=Array.from(e.childNodes)),r(e,a);const W=async e=>{switch(typeof e){case"boolean":return e?x.TRUE:x.FALSE;case"number":return Number.isNaN(e)?x.FALSE:x.TRUE;case"string":return 0===e.length?x.FALSE:x.TRUE;case"object":if(e instanceof Promise)try{return $=x.LOADING,V(),W(await e)}catch(e){return console.error("data-if condition async function failed!",e),x.LOADING}return null===e?x.FALSE:Array.isArray(e)?0===e.length?x.NO_DATA:x.TRUE:0===Object.keys(e).length?x.NO_DATA:x.TRUE;case"undefined":return x.LOADING;default:return x.TRUE}},V=()=>{let n;switch($){case x.NO_DATA:if(0===T.length){n=w;break}n=T;break;case x.LOADING:if(0===N.length){n=M;break}n=N;break;case x.FALSE:n=M;break;default:n=w}r(e,a),n.forEach((n=>{const s=n.cloneNode(!0);l(s),e.appendChild(s),t(s,{model:a,translationModel:f,chainPrefix:d,enableTranslations:u,recursive:!0})}))},z=async n=>{const t=await W(n),a=$!==t;$=t,a&&(V(),p&&e.dispatchEvent(new CustomEvent(O,{bubbles:!0,cancelable:!0,composed:!0,detail:{value:t}})))};if(z(a.getChainValue(h)),s(e,a,b,d),u&&s(e,f,y,d),a.hasExpression(h)){z(a.evaluateExpression(h));const n=()=>{z(a.evaluateExpression(h))};a.onChangeExpressionChain(h,n),i(e,h,n)}else{const n=()=>{z(a.getChainValue(h))};a.onChange(h,n),o(e,h,n)}}(U,K.bindElement,T);else if(_)!function(e,c,{model:f,translationModel:d,chainPrefix:g,enableTranslations:j=!1}={model:null,translationModel:null}){let A=e.getAttribute(u);if(!A.startsWith(b))return void console.warn(`Attribute "${u}" doesn't start with the chain prefix!`);A=A.slice(1);const k=n(g,A),E=function(e){return(e.getAttribute(m)||"").split(" ").filter(String)}(e),P=E.includes(h),C=E.includes(p),O=E.includes(v),N=[],T=[],W=[];let V,z,B=[];const I=e=>{Array.isArray(e)?(V=e,z=e.length):(V=void 0,z=-1)},S=n=>{n.forEach((n=>{const t=n.cloneNode(!0);l(t),e.appendChild(t),c(t,{model:f,translationModel:d,chainPrefix:g,enableTranslations:j,recursive:!0})}))},F=()=>{if(-1===z)return r(e,f),void S(T);if(0===z)return r(e,f),void S(N);if(O){const n=document.createElement(e.tagName),t=Array.prototype.slice.call(e.attributes);let a;for(;a=t.pop();)a.nodeName!==m&&n.setAttribute(a.nodeName,a.nodeValue);E.length>0&&n.setAttribute(m,E.join(" ")),e.insertAdjacentElement("afterend",n),e.remove(),e=n}V.forEach(((t,a)=>{const s=[];W.forEach((e=>{const t=e.cloneNode(!0),o=n(k,a);c(t,{model:f,translationModel:d,chainPrefix:o,enableTranslations:j,recursive:!0}),s.push(t)})),B[a]?s.forEach(((e,n)=>{document.createElement("div").appendChild(B[a][n].cloneNode(!0));const t=q(e),s=q(B[a][n]);D(t,s,B[a][n])})):(s.forEach((n=>{e.appendChild(n)})),B[a]=s)}));for(let e=z;e<B.length;e++)B[e].forEach((e=>{r(e,f),e.remove()}));B.splice(z)},U=(n,t=!1)=>{const a=Array.isArray(n)?n.length:-1,s=z!==a;return I(n),C?(F(),void(P&&e.dispatchEvent(new CustomEvent($,{bubbles:!0,cancelable:!0,composed:!0})))):t||s?(r(e,f),B=[],F(),void(P&&e.dispatchEvent(new CustomEvent(M,{bubbles:!0,cancelable:!0,composed:!0})))):void 0},G=({targetChain:e})=>{const n=k===e;U(f.getChainValue(k),n)};for(I(f.getChainValue(k)),t(e,k);e.childNodes.length>0;){const n=e.childNodes[0];H(n,w)?N.push(n):H(n,x)?T.push(n):W.push(n),a(n,f),n.remove()}if(F(),s(e,f,b,g),j&&s(e,d,y,g),f.onChange(k,G),o(e,k,G),f.hasExpression(k)){const n=()=>{U(f.evaluateExpression(k))};f.onChangeExpressionChain(k,n),i(e,k,n)}}(U,K.bindElement,T);else{const e=U.hasAttribute(B),t=U.hasAttribute(V);if(!U.hasAttribute(I)){if(e||t){let a;if(e?a=U.getAttribute(B):(console.warn(`Attribute "${V}" is deprecated for binding! Use the "${B}" key attribute instead.`,U),a=U.getAttribute(V)),a.startsWith(b)){a=a.slice(1);const e=n(R,a);U.setAttribute(B,`${b}${e}`),t&&U.setAttribute(V,`${b}${e}`),F(U,L,e),d(U,L,e);const s=()=>F(U,L,e);if(L.onChange(e,s),o(U,a,s),L.hasExpression(e)){const n=()=>F(U,L,e);L.onChangeExpressionChain(e,n),i(U,e,n)}}else console.warn(`Invalid chain found! (chain: "${a}")!\n`,`A valid chain must start with "${b}".\n`,"target element:",U)}U.tagName.startsWith(S.toUpperCase())||s(U,L,b,R),X&&s(U,Q,y,R),Array.from(U.childNodes).filter(G).forEach((e=>{J(e,L,Q,R)}))}Y&&Array.from(U.children).forEach((e=>{K.bindElement(e,T)}))}}}else{const n=U(e)?e.tagName.toLowerCase():"text node";console.warn(`No model found for: ${n}!`)}},bindChildNodes:(e,n)=>{Array.from(e.childNodes).forEach((e=>{K.bindElement(e,Object.assign({},n))}))}};export{K as B,U as a,G as i}