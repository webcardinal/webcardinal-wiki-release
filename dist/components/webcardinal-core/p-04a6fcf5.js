import{V as t,b as e,d as n,f as i,h as a,g as r,s as o,F as s,e as c,U as u}from"./p-f5c9fd96.js";import{g as l}from"./p-8d1ed174.js";import"./p-e506992e.js";const d="webcardinal:config:getCoreType",f="webcardinal:config:getDocsSource",h="webcardinal:config:getIdentity",g="webcardinal:config:getLogLevel",v="webcardinal:config:getRouting",p="webcardinal:model:get",b="webcardinal:routing:get",m="webcardinal:tags:get",y="webcardinal:translationModel:get",w="webcardinal:parentChain:get",$=new Map;function k(i){let a=i.hasAttribute(t)?i.getAttribute(t):null;if(!a&&i.hasAttribute(e)&&(console.warn(`Attribute ${e} is deprecated for binding! Use the ${t} key attribute instead.`,i),a=i.getAttribute(e)),!a)return"";if(!a.startsWith(n)){const t=i.tagName.toLowerCase();return console.error([`Invalid chain found for ${t} (chain: "${a}")!`,`A valid chain must start with "${n}".`].join("\n")),""}return a}function M(t,e){return t=t.split("@").join(""),e=e.split("@").join(""),t&&e?`@${t}.${e}`:e?"@"+e:t?"@"+t:"@"}function T(t,e,n){$.set(t,{chain:e,changeHandler:n})}function x(t,e,n){$.set(t,{expression:e,changeHandler:n})}function A(t,e){const n=t=>{if(t.childNodes.length>0)for(const i of t.childNodes){if($.has(i)){const t=$.get(i);t.chain?e.offChange(t.chain,t.changeHandler):e.offChangeExpressionChain(t.expression,t.changeHandler),$.delete(i)}n(i)}};n(t)}function N(t,e,n){let i=null;for(;t;){if(t.matches(e)){i=t;break}if(n&&t.matches(n))break;t=t.parentElement}return i}function j(t,{key:e,value:n}){if(!i.includes(e))if(["innerHTML","innerText"].includes(e)&&console.warn(`Model property "${e}" can be short handed, try "${e.substr(5).toLowerCase()}" instead!\n`,"target element:",t),["data-tag","data-view-model"].includes(e)&&console.warn(`Model property "${e}" can be shorthanded, try "${e.substr(5)}" instead!\n`,"target model:",t.getAttribute("data-model")),function(t){return["value","innerText","innerHTML"].includes(t)}(e=function(t){switch(t){case"model":return"data-view-model";case"tag":return"data-tag";case"text":return"innerText";case"html":return"innerHTML";default:return t}}(e))){if("INPUT"===t.tagName&&"file"===t.getAttribute("type")&&"value"===e)return;t[e]=n}else if("class"!==e)"boolean"!=typeof n?"string"!=typeof n?"object"!=typeof n||(t[e]=n):t.setAttribute(e,n):n?t.setAttribute(e,""):t.removeAttribute(e);else{if(""===n)return void(t.className="");if("string"==typeof n)return void t.classList.add(n);if("object"==typeof n){for(const[e,i]of Object.entries(n))i?t.classList.add(e):t.classList.remove(e);return}}}function C(t,e){return"input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")&&"checked"===e||"value"===e}function I(i,o,s=n,c=null){i.tagName.startsWith(a.toUpperCase())||Array.from(i.attributes).forEach((a=>{const u=a.nodeName;let l=a.nodeValue;if(u===t||u===e)return;if(!l.startsWith(s))return;if(l=l.slice(1),c&&(l=B(c,l)),i.webcModelChains||(i.webcModelChains={}),i.webcModelChains[u]=l,j(i,{key:u,value:o.getChainValue(l)}),r.includes(i.tagName.toLowerCase()))return;s===n&&C(i,u)&&L(i,o,l);const d=()=>{j(i,{key:u,value:o.getChainValue(l)})};if(o.onChange(l,d),T(i,l,d),o.hasExpression(l)){j(i,{key:u,value:o.evaluateExpression(l)}),s===n&&C(i,u)&&L(i,o,l);const t=()=>{j(i,{key:u,value:o.evaluateExpression(l)})};o.onChangeExpressionChain(l,t),x(i,l,t)}}))}function H(t){t.nodeType===Node.ELEMENT_NODE&&(t.removeAttribute("slot"),t.removeAttribute("hidden"))}function L(t,e,n){const i=t.tagName.toLowerCase();["input","textarea"].includes(i)?t.addEventListener("input",(a=>{const r=a.target;"input"!==i||"checkbox"!==t.getAttribute("type")?"input"!==i||"file"!==t.getAttribute("type")?e.setChainValue(n,r.value):e.setChainValue(n,Array.from(r.files)):e.setChainValue(n,r.checked)})):"select"===i&&t.addEventListener("change",(t=>{e.setChainValue(n,t.target.value)}))}function P(t,e,n){if(!e.getChainValue(n))return;const i="input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")?"checked":"value";L(t,e,`${n}.${i}`)}function R(t,e){return Array.from(t.attributes).some((t=>t.nodeName===e))}function U(t,e){return t.filter((t=>t.getAttribute("slot")===e))}function S(t,e){return U(t,e).map((t=>t.outerHTML)).join("")}function q(t,e){for(A(t,e);t.children.length>0;)t.children[0].remove()}function z(t,e){for(A(t,e);t.childNodes.length>0;)t.childNodes[0].remove()}function B(...t){return t.filter((t=>null!=t)).filter(String).join(".")}function D(t){let e;if("function"==typeof t.detail?e=t.detail:t.detail&&"function"==typeof t.detail.callback&&(e=t.detail.callback),e)return e;console.warn("Invalid callback for event",t)}function E(t,e){t.hasAttribute(o)||t.setAttribute(o,""+t.children.length),t.addEventListener("webcardinal:parentChain:get",(n=>{n.stopImmediatePropagation();const i=D(n);if(!i)return;if(n.target&&"string"!=typeof n.target.tagName)return i(void 0,e);let a=n.target;"webc-component"===n.target.tagName.toLowerCase()&&(a=a.parentElement);let r=a;for(;r.parentElement&&!r.parentElement.hasAttribute(s);)r=r.parentElement;if(!r)return i(void 0,e);let c=Array.from(t.children).indexOf(r);if(c<0)return i(void 0,e);let u=Number.parseInt(t.getAttribute(o));return(Number.isNaN(u)||u<=0)&&(u=1),c=Math.floor(c/u),i(void 0,B(e,c))}))}class F{constructor(t,{model:e,translationModel:i,tags:a,routing:r,chain:o}){this.listeners={getModel:()=>null,getTranslationModel:()=>null,getTags:()=>null,getRouting:()=>null,getParentChain:()=>null},this.host=t,e&&(this.listeners.getModel=t=>{t.stopImmediatePropagation();const i=D(t);if(i){if(t.detail.chain){let a=t.detail.chain;return a.startsWith(n)?(a=a.slice(1),void i(void 0,e.getChainValue(a))):(console.warn([`Invalid chain found for ${t} (chain: "${a}")!`,`A valid chain must start with "${n}".`].join("\n")),void i(void 0,e))}i(void 0,e)}}),i&&(this.listeners.getTranslationModel=t=>{t.stopImmediatePropagation();const e=D(t);if(e){if(t.detail.chain){let n=t.detail.chain;return n.startsWith(c)?(n=n.slice(1),void e(void 0,i.getChainValue(n))):(console.warn([`Invalid chain found for ${t} (chain: "${n}")!`,`A valid chain must start with "${c}".`].join("\n")),void e(void 0,i))}e(void 0,i)}}),a&&(this.tags=a,this.listeners.getTags=t=>{t.stopImmediatePropagation();const e=D(t);if(e){if(t.detail.tag){if(!this.tags[t.detail.tag])return e(`There is no page tag "${t.detail.tag}" registered in webcardinal.json`);const n=l(),{pathname:i}=u.join(n.routing.baseURL,this.tags[t.detail.tag]);return e(void 0,i)}return e(void 0,this.tags)}}),r&&(this.routing=r,this.listeners.getRouting=t=>{t.stopImmediatePropagation();const e=D(t);e&&e(void 0,this.routing)}),void 0!==o&&(this.chain=o,this.listeners.getParentChain=t=>{t.stopImmediatePropagation();const e=D(t);e&&e(void 0,this.chain)})}get getModel(){const t="webcardinal:model:get";return{add:()=>this.host.addEventListener(t,this.listeners.getModel),remove:()=>this.host.removeEventListener(t,this.listeners.getModel),eventName:t}}get getTranslationModel(){const t="webcardinal:translationModel:get";return{add:()=>this.host.addEventListener(t,this.listeners.getTranslationModel),remove:()=>this.host.removeEventListener(t,this.listeners.getTranslationModel),eventName:t}}get getParentChain(){const t="webcardinal:parentChain:get";return{add:()=>this.host.addEventListener(t,this.listeners.getParentChain),remove:()=>this.host.removeEventListener(t,this.listeners.getParentChain),eventName:t}}get getTags(){if(!this.tags)return;const t="webcardinal:tags:get";return{add:()=>this.host.addEventListener(t,this.listeners.getTags),remove:()=>this.host.removeEventListener(t,this.listeners.getTags),eventName:t}}get getRouting(){if(!this.routing)return;const t="webcardinal:routing:get";return{add:()=>this.host.addEventListener(t,this.listeners.getRouting),remove:()=>this.host.removeEventListener(t,this.listeners.getRouting),eventName:t}}}export{D as A,E as B,F as C,d as E,f as a,h as b,g as c,v as d,p as e,b as f,m as g,y as h,w as i,N as j,I as k,L as l,P as m,R as n,U as o,S as p,q,H as r,j as s,z as t,B as u,k as v,M as w,T as x,x as y,A as z}